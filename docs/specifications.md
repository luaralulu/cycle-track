# Menstrual Cycle Tracker ‚Äì Software Specification

## Overview

A web-based menstrual cycle tracker for visualising, logging, and predicting period cycles. Built with **TypeScript**, **Vite**, **React**, and **Supabase**. The app supports manual tracking, automated data fill, prediction, and calendar-based display, optimised for both desktop and mobile.

---

## Features

### üîê User Authentication (Login Only)

- Only accessible to logged-in users
- App shows **login screen** by default
- User must authenticate via **Supabase email/password login**
- No account creation from the UI
- Credentials are configured via environment or seeded manually
- Once logged in, user session is cached and used for database access

---

### üî¥ Period Logging

- A single **‚ÄúLog Period‚Äù** button
- When clicked:

  - Inserts a new entry for today with:

    - `cycle_day = 1`
    - `period = true`

  - Automatically updates cycle predictions and calendar display

---

### ‚è±Ô∏è Cron-Based Data Filler

- Runs daily as a cron job
- Checks if **yesterday‚Äôs** data exists
- If missing, inserts a new row:

  - `cycle_day = last known + 1`
  - `period = true` if `cycle_day` in \[2 ‚Äì 5]
  - `period = false` if `cycle_day >= 6`

- Authenticates with Supabase using email and password from `.env`

---

### üîÆ Prediction Algorithm

- Based on **last 12 cycles**
- Predicts:

  - Next **period** (5 days, starts at next estimated `cycle_day = 1`)
  - **PMS window**: 6 ‚Äì 8 days before predicted period start
  - Ovulation day: 14 days before period start (single day, no fertile window)

- Predicted values are marked in the calendar UI

---

### üìÖ Calendar UI

- Month grid layout (similar to Flo app)
- Smooth and intuitive animations for:

  - Month transitions
  - Data display updates

- Colour coding:

  - üî¥ Red/Pink: logged or predicted **period** days
  - ‚ö´ Dark grey with white text: predicted **PMS** days
  - ‚ö™ Neutral: all other days

- Each day is editable by clicking

---

### üìú Multi-Month Scroll Calendar

- **Initial view**: show **current month + next month** stacked vertically after login
- **Vertical stack**: each month rendered as a full-width grid inside a single scroll container
- **Scroll-up fetch**: when user scrolls within the top 10 % of the container, fetch the **previous month** from Supabase and prepend; stop after **6 past months**
- **Scroll-down fetch**: when user scrolls within the bottom 10 % of the container, generate the **next month** using the prediction engine and append; stop after **3 future months**
- **Animations**: new month grids fade/slide in smoothly; scroll position is preserved to avoid jumpiness
- **Data sources**: past months come from Supabase; future months use prediction logic

Great, here's the new section for your `specifications.md`, following the existing markdown style:

---

### üìÜ Google Calendar Integration

- When a user logs a new period and the next **PMS window** and **Period** are predicted, the app creates **all-day, multi-day events** in a Google Calendar.

- Events are added to the calendar defined in `.env` as:

  ```env
  GOOGLE_CYCLE_CALENDAR_ID=<calendar-id>
  ```

- Titles:

  - PMS window: `üßò‚Äç‚ôÄÔ∏è 8 days before bleeding`
  - Period: `ü©∏ Bleeding`

- Duration:

  - PMS window: 3 consecutive days (ending the day before predicted period start)
  - Period: 5 consecutive days (starting on predicted period start)

- Events use the **user‚Äôs local timezone**.

- No updates to calendar events after creation.

#### üõ† Setup & Tokens

- Uses `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` from `.env`:

  ```env
  GOOGLE_CLIENT_ID=<google-client-id>
  GOOGLE_CLIENT_SECRET=<google-client-secret>
  ```

- OAuth tokens are stored in Supabase:

  ```sql
  create table public.google_auth_tokens (
    id bigint generated by default as identity not null,
    user_id uuid not null,
    refresh_token text not null,
    token_pickle bytea not null,
    created_at timestamp with time zone null default timezone ('utc'::text, now()),
    updated_at timestamp with time zone null default timezone ('utc'::text, now()),
    constraint google_auth_tokens_pkey primary key (id),
    constraint google_auth_tokens_user_id_key unique (user_id),
    constraint google_auth_tokens_user_id_fkey foreign key (user_id) references auth.users (id)
  );
  ```

---

## Tech Stack

| Layer            | Technology                                   |
| ---------------- | -------------------------------------------- |
| Frontend         | React + TypeScript + Vite                    |
| Backend/Auth     | Supabase (email/password auth)               |
| Cron Jobs        | GitHub Actions                               |
| Styling/UX       | Tailwind CSS or CSS-in-JS                    |
| Calendar Display | Custom grid or library like `react-calendar` |

---

## Database Schema (already exists)

```sql
create table public.cycle_data (
  id bigint generated by default as identity not null,
  user_id uuid not null,
  date date not null,
  cycle_day integer not null,
  period boolean not null default false,
  created_at timestamp with time zone not null default timezone ('utc'::text, now()),
  constraint cycle_data_pkey primary key (id),
  constraint cycle_data_user_id_date_key unique (user_id, date),
  constraint cycle_data_user_id_fkey foreign key (user_id) references auth.users (id)
);
```

---

## Environment Variables

```env
SUPABASE_URL=<your-supabase-url>
SUPABASE_ANON_KEY=<your-anon-key>
```

---

## Notes

- Must be logged in to access the app
- No registration flow exposed to users
- Should be mobile-friendly
- No offline support or PWA needed at this stage
